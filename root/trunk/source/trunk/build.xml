<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project [<!ENTITY buildfile SYSTEM "file:./build-user.xml">]>
<!-- WARNING: Eclipse autogenerated file. 
              Any modifications will be overwritten.
              Please edit build-user.xml instead.
-->
<project basedir="." default="build" name="org.marketcetera.photon">
    &buildfile;
    <property name="MAVEN_REPO" value="${user.home}/.m2/repository"/>
    <property name="DOWNLOADS_FOLDER" value="target/downloads"/>
    <property name="RCP_ZIP" value="eclipse-RCP-SDK-3.1.2-win32.zip"/>

    <property name="CONSOLE_PLUGIN" value="org.eclipse.ui.console_3.1.2.jar"/>
    <property name="RESOURCES_PLUGIN" value="org.eclipse.core.resources_3.1.2.jar"/>
    <property name="IDE_PLUGIN" value="org.eclipse.ui.ide_3.1.1.jar"/>
    <property name="FORMS_PLUGIN" value="org.eclipse.ui.forms_3.1.0.jar"/>

    <path id="project.classpath">
        <pathelement location="src/main/resources"/>
        <pathelement location="src/test/resources"/>
        <pathelement location="target/classes"/>
        <pathelement location="${MAVEN_REPO}/junit/junit/3.8.1/junit-3.8.1.jar"/>
        <!--pathelement location="${MAVEN_REPO}/jcyclone/jcyclone-core-marketcetera/0.1-SNAPSHOT/jcyclone-core-marketcetera-0.1-SNAPSHOT.jar"/-->
        <pathelement location="${MAVEN_REPO}/log4j/log4j/1.2.13/log4j-1.2.13.jar"/>
        <pathelement location="${MAVEN_REPO}/junit/junit/3.8.1/junit-3.8.1.jar"/>
        <pathelement location="${MAVEN_REPO}/org/skife/kasparov/csv/1.0/csv-1.0.jar"/>
        <pathelement location="${MAVEN_REPO}/org/marketcetera/core/0.1-SNAPSHOT/core-0.1-SNAPSHOT.jar"/>
        <pathelement location="${MAVEN_REPO}/activemq/activemq/4.0-RC2/activemq-4.0-RC2.jar"/>
        <pathelement location="target/downloads/${CONSOLE_PLUGIN}"/>
        <pathelement location="target/downloads/${RESOURCES_PLUGIN}"/>
        <pathelement location="target/downloads/${IDE_PLUGIN}"/>
        <pathelement location="target/downloads/${FORMS_PLUGIN}"/>

        <fileset dir="${MAVEN_REPO}/quickfixj">
            <include name="**/*.jar" />
        </fileset>
        <fileset dir="target/rcp/eclipse/plugins">
            <include name="**/*.jar" />
        </fileset>
    </path>
    <target name="init">
        <mkdir dir="target/classes"/>
        <mkdir dir="target/test-classes"/>
        <mkdir dir="target/test-output"/>
        <mkdir dir="${DOWNLOADS_FOLDER}"/>
        <mkdir dir="target/rcp"/>
        <get src="http://repo.marketcetera.org/eclipse/sdks/${RCP_ZIP}"
            dest="${DOWNLOADS_FOLDER}/${RCP_ZIP}" usetimestamp="true"/>
        <get src="http://repo.marketcetera.org/eclipse/sdks/plugins/${CONSOLE_PLUGIN}" dest="${DOWNLOADS_FOLDER}/${CONSOLE_PLUGIN}" usetimestamp="true"/>
        <get src="http://repo.marketcetera.org/eclipse/sdks/plugins/${RESOURCES_PLUGIN}" dest="${DOWNLOADS_FOLDER}/${RESOURCES_PLUGIN}" usetimestamp="true"/>
        <get src="http://repo.marketcetera.org/eclipse/sdks/plugins/${IDE_PLUGIN}" dest="${DOWNLOADS_FOLDER}/${IDE_PLUGIN}" usetimestamp="true"/>
        <get src="http://repo.marketcetera.org/eclipse/sdks/plugins/${FORMS_PLUGIN}" dest="${DOWNLOADS_FOLDER}/${FORMS_PLUGIN}" usetimestamp="true"/>

        <unzip src="${DOWNLOADS_FOLDER}/${RCP_ZIP}"
                dest="target/rcp" />
        <fail message="You must run 'mvn install' on the Marketcetera core project first">
            <condition>
                <not>
                    <available file="${MAVEN_REPO}/org/marketcetera/core/0.1-SNAPSHOT/core-0.1-SNAPSHOT.jar" />
                </not>
            </condition>
        </fail>
    </target>
    <target name="clean">
        <delete dir="target/classes"/>
        <delete dir="${DOWNLOADS_FOLDER}"/>
     </target>
    <target depends="init" name="build">
        <echo message="${ant.project.name}: ${ant.file}"/>
        <javac destdir="bin">
            <src path="src"/>
            <src path="test"/>
            <classpath refid="project.classpath"/>
        </javac>
    </target>
    <target name="allTests" depends="init">
        <junit fork="yes" printsummary="withOutAndErr" showoutput="true">
            <formatter type="plain"/>
            <batchtest todir="target/test-output">
                <fileset dir="src/test/java" casesensitive="yes">
                  <include name="**/*Test*"/>
                </fileset>
			</batchtest>
            <classpath refid="project.classpath"/>
            <classpath>
                <pathelement location="${MAVEN_REPO}/org/marketcetera/core/0.1-SNAPSHOT/core-0.1-SNAPSHOT-tests.jar"/>
                <pathelement location="target/test-classes"/>
            </classpath>
        </junit>
    </target>
    <target name="compile" depends="init">
        <javac classpathref="project.classpath"
               destdir="target/classes"
            srcdir="src/main/java">
            </javac>
        <javac classpathref="project.classpath"
               destdir="target/test-classes"
            srcdir="src/test/java">
            <classpath>
                <pathelement location="${MAVEN_REPO}/org/marketcetera/core/0.1-SNAPSHOT/core-0.1-SNAPSHOT-tests.jar"/>
            </classpath>

            </javac>
    </target>
</project>
