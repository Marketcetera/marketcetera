<?xml version="1.0" encoding="UTF-8"?>

<!-- START SNIPPET: spring -->
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>


  <bean id="omsCommandsQueue" class="org.apache.activemq.command.ActiveMQQueue">
    <constructor-arg value="oms-commands"/>
  </bean>
	
  <bean id="omsMessagesTopic" class="org.apache.activemq.command.ActiveMQTopic">
    <constructor-arg value="oms-messages"/>
  </bean>

  <bean id="photonControllerListener" class="org.springframework.jms.listener.adapter.MessageListenerAdapter">
    <property name="delegate" ref="photonController"/>
    <property name="defaultListenerMethod" value="handleMessage"/>
    <property name="defaultResponseDestination" ref="omsCommandsQueue"/>
	<property name="messageConverter">
		<bean class="org.marketcetera.spring.JMSFIXMessageConverter"/>
	</property>		
  </bean>
       


  <!-- a thread safe non-pooled MessageListener -->
  <bean id="photonController" class="org.marketcetera.photon.PhotonController" singleton="true">
  </bean>



  <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
   || Internal beans 
   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
  
  <bean id="internalConnectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
    <property name="brokerURL" value="vm://it-oms?broker.persistent=false"/>
  </bean>

  <bean id="quotesTopic" class="org.apache.activemq.command.ActiveMQQueue">
    <constructor-arg value="quotes"/>
  </bean>
	
  <bean id="tradesTopic" class="org.apache.activemq.command.ActiveMQTopic">
    <constructor-arg value="trades"/>
  </bean>

  <bean id="quotesScriptControllerListener" class="org.springframework.jms.listener.adapter.MessageListenerAdapter">
    <property name="delegate" ref="quotesScriptController"/>
    <property name="defaultListenerMethod" value="onEvent"/>
	<property name="messageConverter">
		<bean class="org.marketcetera.spring.JMSFIXMessageConverter"/>
	</property>		
  </bean>

  <bean id="tradesScriptControllerListener" class="org.springframework.jms.listener.adapter.MessageListenerAdapter">
    <property name="delegate" ref="tradesScriptController"/>
    <property name="defaultListenerMethod" value="onEvent"/>
	<property name="messageConverter">
		<bean class="org.marketcetera.spring.JMSFIXMessageConverter"/>
	</property>		
  </bean>
  
  <bean id="quotesScriptContainer" class="org.springframework.jms.listener.SimpleMessageListenerContainer">
    <property name="connectionFactory" ref="internalConnectionFactory"/>
    <property name="messageListener" ref="quotesScriptControllerListener"/>
    <property name="destination" ref="quotesTopic"/>
  </bean>

  <bean id="tradesScriptContainer" class="org.springframework.jms.listener.SimpleMessageListenerContainer">
    <property name="connectionFactory" ref="internalConnectionFactory"/>
    <property name="messageListener" ref="tradesScriptControllerListener"/>
    <property name="destination" ref="tradesTopic"/>
  </bean>
  
  <bean id="quotesScriptController" class="org.marketcetera.photon.scripting.EventScriptController" singleton="true"/>

  <bean id="tradesScriptController" class="org.marketcetera.photon.scripting.EventScriptController" singleton="true"/>
  
  <bean id="quotesJMSTemplate" class="org.springframework.jms.core.JmsTemplate">
    <property name="connectionFactory">
      <ref local="internalConnectionFactory"/>
    </property>
	<property name="defaultDestination" ref="quotesTopic"/>
  </bean>
  
  <bean id="tradesJMSTemplate" class="org.springframework.jms.core.JmsTemplate">
    <property name="connectionFactory">
      <ref local="internalConnectionFactory"/>
    </property>
	<property name="defaultDestination" ref="tradesTopic"/>
  </bean>

</beans>

        <!-- END SNIPPET: spring -->
