<?xml version="1.0" encoding="UTF-8"?>

<!-- START SNIPPET: spring -->
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

  <bean id="orsCommandsQueue" class="org.apache.activemq.command.ActiveMQQueue">
    <constructor-arg value="ors-commands"/>
  </bean>
	
  <bean id="orsMessagesTopic" class="org.apache.activemq.command.ActiveMQTopic">
    <constructor-arg value="ors-messages"/>
  </bean>

  <bean id="externalConnectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
    <property name="brokerURL" ref="brokerURL"/>
  </bean>
  
  <bean id="photonControllerListener" class="org.marketcetera.photon.messaging.PhotonControllerListenerAdapter">
    <!--property name="photonController" ref="photonController"/-->
    <property name="defaultResponseDestination" ref="orsCommandsQueue"/>
	<property name="messageConverter">
		<bean class="org.marketcetera.spring.JMSFIXMessageConverter"/>
	</property>		
  </bean>
  
    <!-- note that this needs to use the non-pooled connection factory -->
  <bean id="scriptingControllerContainer" class="org.marketcetera.photon.messaging.SimpleMessageListenerContainer">
    <property name="connectionFactory" ref="externalConnectionFactory"/>
    <property name="messageListener" ref="scriptingControllerListener"/>
    <property name="destination" ref="orsMessagesTopic"/>
  </bean>
  
  <bean id="scriptingControllerListener" class="org.marketcetera.photon.messaging.ScriptingControllerListenerAdapter">
    <property name="defaultResponseDestination" ref="orsCommandsQueue"/>
	<property name="messageConverter">
		<bean class="org.marketcetera.spring.JMSFIXMessageConverter"/>
	</property>		
  </bean>
  
    <!-- note that this needs to use the non-pooled connection factory -->
  <bean id="photonControllerContainer" class="org.marketcetera.photon.messaging.SimpleMessageListenerContainer">
    <property name="connectionFactory" ref="externalConnectionFactory"/>
    <property name="messageListener" ref="photonControllerListener"/>
    <property name="destination" ref="orsMessagesTopic"/>
  </bean>


  <bean id="pooledExternalConnectionFactory" class="org.apache.activemq.pool.PooledConnectionFactory">
    <property name="connectionFactory" ref="externalConnectionFactory"/>
  </bean>

  <!-- Spring JMS Template -->
  <bean id="outgoingJmsTemplate" class="org.springframework.jms.core.JmsTemplate">
    <property name="connectionFactory">
      <ref local="pooledExternalConnectionFactory"/>
    </property>
	<property name="defaultDestination" ref="orsCommandsQueue"/>
	<property name="messageConverter">
	   <bean class="org.marketcetera.spring.JMSFIXMessageConverter"/>
	</property>
  </bean>

</beans>  