<?xml version="1.0" encoding="UTF-8"?>
<!-- Spring Configuration for the QuickFIX component of the OMS applications
 version: $Id$
 author: Toli Kuznets
 -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd">
    <bean id="jdbcLogFactory" class="quickfix.JdbcLogFactory">
        <constructor-arg>
            <ref bean="sessionSettings"/>
        </constructor-arg>
    </bean>

    <!-- Currently unused but there if you want to swap out SLF4j -->
    <bean id="screenLogFactory" class="quickfix.ScreenLogFactory">
        <constructor-arg value="true"/>
        <constructor-arg value="true"/>
        <constructor-arg value="true"/>
        <constructor-arg value="false"/>
    </bean>

    <bean id="slf4jLogFactory" class="quickfix.SLF4JLogFactory">
        <constructor-arg>
            <ref bean="sessionSettings"/>
        </constructor-arg>
    </bean>

    <bean id="comboLogFactory" class="quickfix.CompositeLogFactory">
        <constructor-arg>
            <list>
                <ref bean="jdbcLogFactory"/>
                <ref bean="slf4jLogFactory"/>
            </list>
        </constructor-arg>
    </bean>

    <bean id="dataDictionary" class="quickfix.DataDictionary">
        <constructor-arg ref="quickfix_FIX42_URLstring" type="java.lang.String"/>
    </bean>

	<bean id="sessionSettings" class="quickfix.spring.SessionSettings">
		<property name="defaults">
			<map>
                <entry key="ConnectionType" value="initiator"/>
                <entry key="HeartBtInt" value="30"/>
                <entry key="FileStorePath" value="store"/>
                <entry key="StartTime" value="00:00:00"/>
                <entry key="EndTime" value="00:00:00"/>
                <entry><key><value>DataDictionary</value></key><ref bean="quickfix_FIX42_URL" /></entry>
                <entry key="UseDataDictionary" value="Y"/>
                <entry key="ReconnectInterval" value="15"/>
                <entry key="ResetOnLogout" value="Y"/>
                <entry key="ResetOnDisconnect" value="Y"/>
                <entry key="SendResetSeqNumFlag" value="Y"/>
                <entry key="JdbcDriver" value="com.mysql.jdbc.Driver"/>
                <entry key="JdbcURL" value="jdbc:mysql://localhost/marketcetera"/>
                <entry key="JdbcUser" value="marketcetera"/>
                <entry key="JdbcPassword" value="marketcetera"/>
			</map>
		</property>
		<property name="sessionDescriptors">
			<list>
				<bean class="quickfix.spring.SessionDescriptor">
					<property name="sessionID" ref="defaultSessionID"/>
					<property name="settings">
						<map>
                            <entry key="SocketConnectHost"><ref bean="socketConnectHostValue"/></entry>
							<entry key="SocketConnectPort"><ref bean="socketConnectPortValue"/></entry>
						</map>
					</property>
				</bean>
			</list>
		</property>
	</bean>
	
    <bean id="messageStoreFactory" class="quickfix.FileStoreFactory">
        <constructor-arg>
        	<ref bean="sessionSettings"/>
        </constructor-arg>		
    </bean>

    <bean id="messageFactory" class="quickfix.fix42.MessageFactory"/>

    <!-- Sessions are configured directly in the Spring configuration -->
    <!-- There is no use of the standard QF configuration file -->

	<bean id="qfApplication" class="org.marketcetera.oms.QuickFIXApplication" scope="singleton">
	  <property name="jmsOperations" ref="outgoingJmsTemplate"/>
	</bean>

    <bean id="socketInitiator" class="quickfix.spring.SocketInitiator">
		<constructor-arg ref="qfApplication"/>
		<constructor-arg ref="messageStoreFactory"/>
		<constructor-arg ref="sessionSettings"/>
		<constructor-arg ref="comboLogFactory"/>
		<constructor-arg ref="messageFactory"/>
    </bean>
</beans>

