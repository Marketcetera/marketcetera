<?xml version="1.0" encoding="UTF-8" ?>

<!-- 
  - Main server configuration. 
  - 
  - Author: colin@marketcetera.com
  - Since: $Release$ 
  - Version: $Id: main.xml 82351 2012-05-04 21:46:58Z colin $ 
  - $License$ 
-->

<!-- - See 'README.html' for detailed documentation. -->

<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:security="http://www.springframework.org/schema/security"
       xmlns:tx="http://www.springframework.org/schema/tx"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
	                       http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
	                       http://www.springframework.org/schema/context
                           http://www.springframework.org/schema/context/spring-context-3.1.xsd
                           http://www.springframework.org/schema/security
                           http://www.springframework.org/schema/security/spring-security-3.1.xsd
                           http://www.springframework.org/schema/tx
                           http://www.springframework.org/schema/tx/spring-tx.xsd">
	<context:component-scan base-package="org.marketcetera"/>
    <context:annotation-config/>
	<tx:annotation-driven/>
    <security:global-method-security pre-post-annotations="enabled" />
    <!-- security -->
    <security:authentication-manager alias="authenticationManager">
        <security:authentication-provider user-service-ref='hibernateUserDao'>
            <security:password-encoder base64="false" hash="plaintext" ref="passwordEncoder"/>
        </security:authentication-provider>
    </security:authentication-manager>
    <bean id="passwordEncoder" class="org.marketcetera.security.impl.PBKDF2Encoder">
        <property name="salt" value="qgutHcgZPom42nb3tYqM26NXJLhRxAqbTe7mvRHYsaTxc9762X4+BUem3p7wC2WKsrCuWorWzMrh7R/FFcJ7yw=="/>
    </bean>
    <!-- database -->
	<bean id="sessionFactory" class="org.springframework.orm.hibernate4.LocalSessionFactoryBean">
		<property name="dataSource" ref="hsqldbInMemoryDataSource" />
        <!-- property name="dataSource" ref="mySqlDataSource" /-->
		<property name="packagesToScan">
			<list>
				<value>org.marketcetera.dao</value>
			</list>
		</property>
		<property name="hibernateProperties">
			<props>
				<prop key="hibernate.dialect">org.hibernate.dialect.HSQLDialect</prop>
                <!--prop key="hibernate.dialect">org.hibernate.dialect.MySQLDialect</prop-->
                <prop key="hibernate.hbm2ddl.auto">create</prop>
                <prop key="hibernate.show_sql">true</prop>
			</props>
		</property>
	</bean>
    <bean id="transactionManager" class="org.springframework.orm.hibernate4.HibernateTransactionManager">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>
    <bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor"/>
    <!-- data sources -->
    <bean id="hsqldbInMemoryDataSource" class="org.apache.commons.dbcp.BasicDataSource">
        <property name="driverClassName" value="org.hsqldb.jdbcDriver"/>
        <property name="url" value="jdbc:hsqldb:mem:marketcetera"/>
        <property name="username" value="sa"/>
        <property name="password" value=""/>
    </bean>
    <bean id="mySqlDataSource" class="org.apache.commons.dbcp.BasicDataSource">
        <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost/lazard"/>
        <property name="username" value="lazard"/>
        <property name="password" value="lazard"/>
    </bean>
    <!-- symbol resolution -->
    <bean id="futureSymbolResolver" class="org.marketcetera.core.symbolresolver.impl.FutureSymbolResolver"/>
    <bean id="convertibleBondSymbolResolver" class="org.marketcetera.core.symbolresolver.impl.ConvertibleBondSymbolResolver"/>
    <bean id="osiOptionSymbolResolver" class="org.marketcetera.core.symbolresolver.impl.OsiOptionSymbolResolver"/>
    <bean id="equitySymbolResolver" class="org.marketcetera.core.symbolresolver.impl.EquitySymbolResolver"/>
    <bean id="symbolResolverManager" class="org.marketcetera.core.symbolresolver.impl.SymbolResolverManagerImpl">
      <property name="symbolResolvers">
        <list>
          <ref bean="futureSymbolResolver"/>
          <ref bean="osiOptionSymbolResolver"/>
          <ref bean="equitySymbolResolver"/>
          <ref bean="convertibleBondSymbolResolver"/>
        </list>
      </property>
    </bean>
    <!-- system initialization -->
    <bean class="org.marketcetera.executioncontainer.MarketceteraCore"/>
    <!-- test bean -->
    <bean class="org.marketcetera.executioncontainer.ReutersTest"/>
</beans>
