<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0">

    <cm:property-placeholder persistent-id="org.marketcetera.datasource" update-strategy="none">
        <cm:default-properties>

            <!-- JDBC Drivers -->
            <!--<cm:property name="jdbc.driverClassName" value="org.postgresql.Driver"/>-->
            <!--<cm:property name="jdbc.url" value="jdbc:postgresql:metc"/>-->
            <!--<cm:property name="jdbc.username" value="metc"/>-->
            <!--<cm:property name="jdbc.password" value="pw4metc"/>-->

            <!-- Connection Pooling DBCP -->
            <cm:property name="jdbc.initialSize" value="5"/>
            <cm:property name="jdbc.maxActive" value="10"/>
            <cm:property name="jdbc.maxIdle" value="10"/>
            <cm:property name="jdbc.defaultAutoCommit" value="false"/>
            <cm:property name="jdbc.removeAbandoned" value="false"/>
            <cm:property name="jdbc.removeAbandonedTimeout" value="300"/>
            <cm:property name="jdbc.logAbandoned" value="false"/>

        </cm:default-properties>
    </cm:property-placeholder>

    <service auto-export="interfaces">
        <service-properties>
            <entry key="transactional" value="true"/>
        </service-properties>

        <bean class="org.enhydra.jdbc.standard.StandardXADataSource">
            <property name="driverName" value="${jdbc.driverClassName}"/>
            <property name="url" value="${jdbc.url}"/>
            <property name="user" value="${jdbc.username}"/>
            <property name="password" value="${jdbc.password}"/>
            <property name="minCon" value="1"/>
            <property name="maxCon" value="${jdbc.maxActive}"/>
        </bean>
    </service>

    <service auto-export="interfaces">
        <service-properties>
            <entry key="transactional" value="false"/>
        </service-properties>

        <bean class="org.apache.commons.dbcp.BasicDataSource">
            <property name="driverClassName" value="${jdbc.driverClassName}"/>
            <property name="url" value="${jdbc.url}"/>
            <property name="username" value="${jdbc.username}"/>
            <property name="password" value="${jdbc.password}"/>
            <property name="initialSize" value="${jdbc.initialSize}"/>
            <property name="maxActive" value="${jdbc.maxActive}"/>
            <property name="maxIdle" value="${jdbc.maxIdle}"/>
            <property name="defaultAutoCommit" value="false"/>
            <property name="removeAbandoned" value="${jdbc.removeAbandoned}"/>
            <property name="removeAbandonedTimeout" value="${jdbc.removeAbandonedTimeout}"/>
            <property name="logAbandoned" value="${jdbc.logAbandoned}"/>
        </bean>
    </service>

    <reference id="txManager" interface="javax.transaction.TransactionManager" availability="mandatory"/>

</blueprint>
