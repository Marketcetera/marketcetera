<?xml version="1.0" encoding="UTF-8"?>
<!-- Spring Configuration for the QuickFIX component of the ORS applications
 version: $Id$
 author: Toli Kuznets
 -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd">

    <!-- Currently unused but there if you want to swap out SLF4j -->
    <bean id="screenLogFactory" class="quickfix.ScreenLogFactory">
        <constructor-arg value="true"/>
        <constructor-arg value="true"/>
        <constructor-arg value="true"/>
        <constructor-arg value="false"/>
    </bean>

    <bean id="slf4jLogFactory" class="quickfix.SLF4JLogFactory">
        <constructor-arg ref="sessionSettings"/>
    </bean>

	<bean id="sessionSettings" class="quickfix.spring.SessionSettings">
		<property name="defaults">
			<map>
                <entry key="ConnectionType" value="initiator"/>
                <entry key="HeartBtInt" value="30"/>
                <entry key="FileStorePath" value="${quickfix.store}"/>
                <entry key="StartTime" value="00:00:00"/>
                <entry key="EndTime" value="00:00:00"/>
                <entry key="DataDictionary" value-ref="fixDictionaryPath"/>
                <entry key="UseDataDictionary" value="Y"/>
                <entry key="ReconnectInterval" value="15"/>
                <entry key="ResetOnLogout" value="Y"/>
                <entry key="ResetOnDisconnect" value="Y"/>
                <entry key="JdbcDriver" value-ref="JdbcDriver"/>
                <entry key="JdbcURL" value-ref="JdbcURL"/>
                <entry key="JdbcUser" value-ref="JdbcUser"/>
                <entry key="JdbcPassword" value-ref="JdbcPassword"/>
                <entry key="JdbcLogHeartBeats" value="N"/>
                <!-- leave the heartbeats out for slf4j logger -->
                <entry key="SLF4JLogHeartbeats" value="N"/>
            </map>
		</property>
		<property name="sessionDescriptors">
			<list>
				<bean class="quickfix.spring.SessionDescriptor">
					<property name="sessionID" ref="defaultSessionID"/>
					<property name="settings">
						<map>
                            <entry key="SocketConnectHost"><ref bean="socketConnectHostValue"/></entry>
							<entry key="SocketConnectPort"><ref bean="socketConnectPortValue"/></entry>
						</map>
					</property>
				</bean>
			</list>
		</property>
	</bean>
	
    <bean id="messageStoreFactory" class="quickfix.FileStoreFactory">
        <constructor-arg ref="sessionSettings"/>
    </bean>

    <bean id="fixMessageFactory" factory-bean="fixVersionEnum" factory-method="getMessageFactory" />
    <bean id="messageFactory" factory-bean="fixMessageFactory" factory-method="getUnderlyingMessageFactory" />

    <!-- Sessions are configured directly in the Spring configuration -->
    <!-- There is no use of the standard QF configuration file -->

	<bean id="qfApplication" class="org.marketcetera.ors.QuickFIXApplication"
        scope="singleton" depends-on="broker">
        <constructor-arg ref="fixMessageFactory"/>
        <property name="jmsOperations" ref="outgoingJmsTemplate"/>
        <property name="tradeRecorderJMS" ref="tradeRecorderJMSTemplate"/>
    </bean>

    <bean id="socketInitiator" class="quickfix.spring.SocketInitiator">
		<constructor-arg ref="qfApplication"/>
		<constructor-arg ref="messageStoreFactory"/>
		<constructor-arg ref="sessionSettings"/>
		<constructor-arg ref="slf4jLogFactory"/>
		<constructor-arg ref="messageFactory"/>
    </bean>
</beans>

